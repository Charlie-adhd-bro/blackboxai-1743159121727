<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Экскурсии | Память Урала</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .tour-card {
            transition: transform 0.3s ease;
        }
        .tour-card:hover {
            transform: translateY(-5px);
        }
        #booking-modal {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-landmark text-2xl text-yellow-400"></i>
                <a href="index.html" class="text-2xl font-bold">Память Урала</a>
            </div>
            <nav class="hidden md:block">
                <ul class="flex space-x-6">
                    <li><a href="index.html" class="hover:text-yellow-300">Главная</a></li>
                    <li><a href="memorials.html" class="hover:text-yellow-300">Мемориалы</a></li>
                    <li><a href="heroes.html" class="hover:text-yellow-300">Герои</a></li>
                    <li><a href="tours.html" class="font-bold text-yellow-300">Экскурсии</a></li>
                    <li><a href="contacts.html" class="hover:text-yellow-300">Контакты</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-button md:hidden text-2xl" aria-expanded="false" aria-label="Меню">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu hidden md:hidden bg-blue-900 text-white">
            <ul class="px-4 py-2 space-y-2">
                <li><a href="index.html" class="block py-2 hover:text-yellow-300">Главная</a></li>
                <li><a href="memorials.html" class="block py-2 hover:text-yellow-300">Мемориалы</a></li>
                <li><a href="heroes.html" class="block py-2 hover:text-yellow-300">Герои</a></li>
                <li><a href="tours.html" class="block py-2 hover:text-yellow-300">Экскурсии</a></li>
                <li><a href="contacts.html" class="block py-2 hover:text-yellow-300">Контакты</a></li>
            </ul>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl md:text-4xl font-bold mb-8 text-center text-blue-900">Туристические маршруты</h1>
        
        <!-- Tours Grid -->
        <div class="grid md:grid-cols-2 gap-8" id="tours-grid">
            <!-- Tours will be loaded here -->
        </div>
    </main>

    <!-- Booking Modal -->
    <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold">Забронировать тур</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Tour Info -->
                    <div>
                        <h4 id="modal-tour-title" class="text-xl font-bold mb-2"></h4>
                        <p id="modal-tour-dates" class="text-gray-600 mb-2"></p>
                        <p id="modal-tour-duration" class="text-gray-600 mb-4"></p>
                        <p id="modal-tour-route" class="text-gray-700"></p>
                    </div>
                    
                    <!-- Booking Form -->
                    <div>
                        <form id="booking-form">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Дата тура</label>
                                <select id="tour-date" class="w-full p-2 border rounded" required>
                                    <!-- Dates will be loaded -->
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Количество человек</label>
                                <input type="number" id="total-people" min="1" class="w-full p-2 border rounded" required>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">Дети до 10 лет</label>
                                    <input type="number" id="children" min="0" class="w-full p-2 border rounded">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Пенсионеры</label>
                                    <input type="number" id="pensioners" min="0" class="w-full p-2 border rounded">
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="is-group" class="mr-2">
                                    <span>Групповая заявка (10+ человек)</span>
                                </label>
                            </div>
                            
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="is-school-group" class="mr-2">
                                    <span>Школьная группа (20+ человек)</span>
                                </label>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="font-bold mb-2">Контактные данные</h4>
                                <input type="text" id="client-name" placeholder="ФИО" class="w-full p-2 border rounded mb-2" required>
                                <input type="tel" id="client-phone" placeholder="Телефон" class="w-full p-2 border rounded mb-2" required>
                                <input type="email" id="client-email" placeholder="Email" class="w-full p-2 border rounded mb-2" required>
                                <textarea id="client-notes" placeholder="Дополнительные пожелания" class="w-full p-2 border rounded" rows="2"></textarea>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-800 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition font-bold">
                                <i class="fas fa-check-circle mr-2"></i> Забронировать тур
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold">Подтверждение бронирования</h3>
                <button id="close-confirmation" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div id="confirmation-details" class="space-y-4">
                <!-- Booking details will be shown here -->
            </div>
            
            <button id="print-booking" class="mt-6 bg-blue-800 text-white py-2 px-4 rounded hover:bg-blue-700 transition">
                Распечатать подтверждение
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-blue-900 text-white py-12">
        <!-- Same footer as other pages -->
    </footer>

    <script src="js/mobile-menu.js"></script>
    <script src="js/booking.js"></script>
    <script>
        // Load tours data
        fetch('assets/tours.json')
            .then(response => response.json())
            .then(tours => {
                renderTours(tours);
                setupBooking(tours);
            });

        function renderTours(tours) {
            const grid = document.getElementById('tours-grid');
            grid.innerHTML = '';
            
            tours.forEach(tour => {
                grid.innerHTML += `
                    <div class="tour-card bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="h-48 bg-gray-200 flex items-center justify-center">
                            <img src="${tour.image || 'assets/images/tour-placeholder.jpg'}" alt="${tour.title}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-6">
                            <h2 class="text-xl font-bold mb-2">${tour.title}</h2>
                            <p class="text-gray-600 mb-1">${tour.duration}</p>
                            <p class="text-gray-700 mb-4">${tour.description}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold">${tour.price} ₽</span>
                                <button data-tour-id="${tour.id}" class="book-btn bg-blue-800 text-white py-2 px-4 rounded hover:bg-blue-700 transition">
                                    Забронировать
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function setupBooking(tours) {
            const bookingModal = document.getElementById('booking-modal');
            const confirmationModal = document.getElementById('confirmation-modal');
            let currentTour = null;

            // Open booking modal
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('book-btn')) {
                    const tourId = e.target.getAttribute('data-tour-id');
                    currentTour = tours.find(t => t.id == tourId);
                    openBookingModal(currentTour);
                }
            });

            // Close modals
            document.getElementById('close-modal').addEventListener('click', () => {
                bookingModal.classList.add('hidden');
            });

            document.getElementById('close-confirmation').addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
            });

            // Handle form submission
            document.getElementById('booking-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Валидация обязательных полей
                const requiredFields = [
                    document.getElementById('client-name'),
                    document.getElementById('client-phone'),
                    document.getElementById('client-email'),
                    document.getElementById('total-people')
                ];
                
                for (const field of requiredFields) {
                    if (!field.value.trim()) {
                        alert(`Пожалуйста, заполните поле "${field.placeholder}"`);
                        field.focus();
                        return;
                    }
                }

                // Валидация телефона
                const phone = document.getElementById('client-phone').value;
                if (!/^[\d\s\-\+\(\)]{10,15}$/.test(phone)) {
                    alert('Пожалуйста, введите корректный номер телефона (10-15 цифр)');
                    return;
                }
                
                // Валидация email
                const email = document.getElementById('client-email').value;
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    alert('Пожалуйста, введите корректный email');
                    return;
                }
                
                showConfirmation(currentTour);
            });

            // Print booking
            document.getElementById('print-booking').addEventListener('click', function() {
                window.print();
            });

            document.getElementById('back-to-tours').addEventListener('click', function() {
                document.getElementById('confirmation-modal').classList.add('hidden');
                // Сбрасываем форму
                document.getElementById('booking-form').reset();
                document.getElementById('client-name').value = '';
                document.getElementById('client-phone').value = '';
                document.getElementById('client-email').value = '';
                document.getElementById('client-notes').value = '';
            });
        }

        function openBookingModal(tour) {
            document.getElementById('modal-tour-title').textContent = tour.title;
            document.getElementById('modal-tour-duration').textContent = `Длительность: ${tour.duration}`;
            
            const datesSelect = document.getElementById('tour-date');
            datesSelect.innerHTML = tour.dates.map(date => 
                `<option value="${date}">${new Date(date).toLocaleDateString('ru-RU')}</option>`
            ).join('');
            
            const routeList = tour.route.map(item => `<li class="mb-1">- ${item}</li>`).join('');
            document.getElementById('modal-tour-route').innerHTML = `
                <h4 class="font-bold mb-2">Маршрут:</h4>
                <ul>${routeList}</ul>
            `;
            
            document.getElementById('booking-modal').classList.remove('hidden');
        }

            function showConfirmation(tour) {
                const form = document.getElementById('booking-form');
                const totalPeople = parseInt(form.elements['total-people'].value);
                const children = parseInt(form.elements['children'].value) || 0;
                const pensioners = parseInt(form.elements['pensioners'].value) || 0;
                const isGroup = form.elements['is-group'].checked;
                const isSchoolGroup = form.elements['is-school-group'].checked;
                const selectedDate = form.elements['tour-date'].value;
                const clientName = document.getElementById('client-name').value;
                const clientPhone = document.getElementById('client-phone').value;
                const clientEmail = document.getElementById('client-email').value;
                const clientNotes = document.getElementById('client-notes').value;

            // Calculate price
            let discount = 0;
            let discountReason = '';
            
            if (isSchoolGroup && totalPeople >= 20) {
                discount = 0.04;
                discountReason = 'Школьная группа (4%) + 1 сопровождающий бесплатно';
            } else if (isGroup && totalPeople >= 10) {
                discount = 0.03;
                discountReason = 'Групповая скидка (3%)';
            }
            
            // Additional 2% for children and pensioners
            const specialDiscount = (children + pensioners) * 0.02;
            if (specialDiscount > 0) {
                discount += specialDiscount;
                if (discountReason) discountReason += ' + ';
                discountReason += `Льготная категория (${specialDiscount * 100}%)`;
            }
            
            const basePrice = tour.price * totalPeople;
            const finalPrice = basePrice * (1 - discount);

            // Generate random booking number
            const bookingNumber = 'BK-' + Math.floor(100000 + Math.random() * 900000);

            // Show confirmation
            document.getElementById('confirmation-details').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-2">Ваше бронирование подтверждено!</h3>
                        <p class="text-gray-700">Мы отправили подтверждение на ${clientEmail}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="font-bold">Номер бронирования:</div>
                        <div class="text-blue-800 font-bold">${bookingNumber}</div>
                        
                        <div class="font-bold">Тур:</div>
                        <div>${tour.title}</div>
                        
                        <div class="font-bold">Дата:</div>
                        <div>${new Date(selectedDate).toLocaleDateString('ru-RU')}</div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <h4 class="font-bold mb-2 text-blue-800">Контактные данные:</h4>
                        <p><i class="fas fa-user mr-2 text-gray-600"></i> ${clientName}</p>
                        <p><i class="fas fa-phone mr-2 text-gray-600"></i> ${clientPhone}</p>
                        <p><i class="fas fa-envelope mr-2 text-gray-600"></i> ${clientEmail}</p>
                        ${clientNotes ? `<p class="mt-2"><i class="fas fa-sticky-note mr-2 text-gray-600"></i> <span class="font-bold">Примечания:</span> ${clientNotes}</p>` : ''}
                    </div>
                    
                    <div class="border-t pt-4 grid grid-cols-2 gap-4">
                        <div class="font-bold">Количество человек:</div>
                        <div>${totalPeople} (${children} детей, ${pensioners} пенсионеров)</div>
                        
                        <div class="font-bold">Стоимость:</div>
                        <div>${basePrice.toFixed(2)} ₽</div>
                        
                        <div class="font-bold">Скидка:</div>
                        <div>${(discount * 100).toFixed(0)}% (${discountReason})</div>
                        
                        <div class="font-bold">Итого к оплате:</div>
                        <div class="text-lg font-bold text-blue-800">${finalPrice.toFixed(2)} ₽</div>
                    </div>
                </div>
            `;

            document.getElementById('booking-modal').classList.add('hidden');
            document.getElementById('confirmation-modal').classList.remove('hidden');
        }
    </script>
</body>
</html>